<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.acsm.module.transaction.order.dal.mysql.confignumber.ConfigNumberMapper">

    <!--
        一般情况下，尽可能使用 Mapper 进行 CRUD 增删改查即可。
        无法满足的场景，例如说多表关联查询，才使用 XML 编写 SQL。
        代码生成器暂时只生成 Mapper XML 文件本身，更多推荐 MybatisX 快速开发插件来生成查询。
        文档可见：https://www.iocoder.cn/MyBatis/x-plugins/
     -->

    <select id="getConfigNumber" resultType="cn.acsm.module.transaction.order.dal.dataobject.confignumber.ConfigNumberDO">
        select
        table_name as tableName,
        time,
        number
        from order_config_number where table_name =  #{tableName}
        <if test ='time!= null and time !=null '>
          and DATE_FORMAT( time,'%Y-%m-%d') = DATE_FORMAT(#{time}, '%Y-%m-%d')
        </if>
        ORDER BY time DESC
        LIMIT 1
    </select>

    <update id="updateConfigNumber">
        UPDATE order_config_number set number = #{number}
        where  table_name =  #{tableName}
        <if test ='time!= null and time !=null '>
           and DATE_FORMAT( time,'%Y-%m-%d') = DATE_FORMAT(#{time}, '%Y-%m-%d')
        </if>
    </update>


</mapper>
